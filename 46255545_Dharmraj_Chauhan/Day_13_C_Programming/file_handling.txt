#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>

 

#define MAX_RANGE 1023
#define MAX_LENGTH 30
#define EXIT_SUCCESS 0
#define EXIT_FAILURE 1

 

// for validate the input
int val_input(char *input){ //server0:0 server1:1021 server2:22 server3:1 server4:1022
    char *sname = NULL;
    char *portnum = NULL;
    char token[MAX_LENGTH];
    int portNo;
    
    int serverLen;
    int portLen;
    
    // return values
    int flag1 = 1, flag2 = 1;
    
    strcpy(token,input);
    
    sname = strtok(token, ":");
    // printf("serverName:- %s", serverName); 
    portnum = strtok(NULL, ":");
    // printf("portNumber:- %s", portNumber); 
    serverLen = strlen(sname);
    portLen = strlen(portnum);
    
    // checking server name
    for(int i = 0; i < serverLen; i++){
        if(!isalpha(sname[i])){
            flag1 = 0;
            break;
        }
    }
    // checking port name
    for(int i = 0; i < portLen; i++){
        if(!isdigit(portnum[i])){
            flag2 = 0;
            break;
        }
    }
    
    // funcation return part handler
    if(flag1 && flag2){
        // convert string into int and check weather it's between 0 to 1023
        if(atoi(portnum)>0 && atoi(portnum)<= MAX_RANGE){
            return (EXIT_FAILURE);
        }
    }
    return(EXIT_SUCCESS);
}
    
char* display(char *input){
    
    // printf("\nstart the second func");
    char token[MAX_LENGTH];
    
    char *sname = NULL;
    char *portnum = NULL;
    char *name = NULL;
    int serverLen;
    
    // printf("\nsec func part1 complete");
    strcpy(token,input);
    sname = strtok(token, ":");
    portnum = strtok(NULL, ":");
    
    // printf("\nsec func part2 complete");
    printf("\nServer Name: %s\t Port No: %s\n", sname, portnum);
    serverLen = strlen(sname);
    name = (char*) calloc((serverLen+1), sizeof(char));
    strcpy(name, sname);
    // printf("\nsec func part3 complete");
    return name;
}
    
int main(int argc, char *argv[]){
    int i, value;
    char *fullstring[MAX_LENGTH];
    char *name = NULL;
    char str[MAX_LENGTH];
    
    if(argc < 3){
        printf("\nPlease provide more then 3 arguments!!!");
        exit(EXIT_FAILURE);     
    }
    
    for(i = 1; i < argc; i++){
        value = val_input(argv[i]);
        if(value == 1){
            exit(EXIT_FAILURE);
        }
        printf("Second funcation direct print:-");
        name = display(argv[i]);
        fullstring[i] = name;
    }
    
    for(i = 1; i < argc; i++){
        printf("\nprintf :- %s", fullstring[i]);
    }
    printf("\nhii i am");
    for (int i=0; i<argc; i++) {
        printf("free:- %s\n",fullstring[i]);
        free(fullstring[i]);
    }
    printf("\nsizeof:-  %ld", sizeof(fullstring));
    return 0;
}
